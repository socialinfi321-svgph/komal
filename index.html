<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>CityKart Review Promotion</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Rubik+Wet+Paint&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      height: 100%; width: 100%; overflow-x: hidden; touch-action: pan-x pan-y; 
    }

    body {
      font-family: 'Poppins', Arial, sans-serif;
      background-color: #f4f6f8;
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
      text-align: center; padding-top: 60px; padding-bottom: 50px;
    }

    /* TOP BANNER */
    .top-banner {
        position: fixed; top: 0; left: 0; width: 100%; height: 50px;
        background: linear-gradient(135deg, #b71c1c, #d32f2f, #ef5350); 
        display: flex; justify-content: center; align-items: center;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 1000;
    }
    .banner-text {
        color: white; font-size: 20px; font-weight: 800; letter-spacing: 1px;
        text-transform: uppercase;
    }

    /* MENU & BUTTONS */
    .menu-btn {
      position: fixed; top: 15px; left: 20px; width: 24px; height: 20px; 
      background: transparent; border: none; cursor: pointer;
      display: flex; flex-direction: column; justify-content: space-between;
      align-items: flex-start; z-index: 1002;
    }
    .menu-btn span {
      height: 2px; background: #fff; border-radius: 4px; width: 100%;
    }

    /* INSTRUCTION BUTTON */
    .instruction-btn {
      position: fixed; bottom: 20px; right: 20px; width: 45px; height: 45px;
      background: linear-gradient(135deg, #0a1628, #1e3a5f);
      border: 2px solid #00d4ff; border-radius: 50%; cursor: pointer;
      display: flex; justify-content: center; align-items: center;
      z-index: 1001; box-shadow: 0 4px 15px rgba(0, 212, 255, 0.3);
    }
    .instruction-btn::before { content: 'ü§ñ'; font-size: 22px; }

    /* TYPE BUTTON */
    .type-btn-fixed {
        position: fixed; bottom: 20px; left: 20px; width: 45px; height: 45px;
        background: #43a047; color: white; border: none; border-radius: 50%;
        cursor: pointer; font-weight: 700; font-size: 10px;
        display: flex; justify-content: center; align-items: center;
        transition: 0.3s; box-shadow: 0 4px 15px rgba(67, 160, 71, 0.3);
        text-transform: uppercase; z-index: 1001;
    }
    .type-btn-fixed:hover { transform: scale(1.1); }

    /* QUICK INFO BOX */
    .quick-info-box {
      position: fixed; bottom: 75px; right: 20px; width: auto; max-width: 200px;
      background: rgba(10, 22, 40, 0.9); backdrop-filter: blur(5px);
      border: 1px solid rgba(0, 212, 255, 0.3); border-radius: 12px;
      padding: 10px 12px; z-index: 1000; opacity: 0; pointer-events: none;
      transition: all 0.4s ease; text-align: left; transform: translateY(10px);
    }
    .quick-info-box.show { transform: translateY(0); opacity: 1; pointer-events: auto; }
    .info-step { color: #00d4ff; font-size: 10px; font-weight: 600; margin-bottom: 3px; }

    /* SIDE MENU */
    .side-menu {
      position: fixed; top: 0; left: -100%; width: 280px; height: 100%;
      background: white; z-index: 1000; transition: left 0.3s ease; 
      padding: 80px 25px 25px 25px; box-shadow: 2px 0 15px rgba(0,0,0,0.1);
    }
    .side-menu.open { left: 0; }
    .menu-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5); z-index: 999; display: none;
    }
    .menu-overlay.show { display: block; }
    .menu-content h3 { font-size: 18px; margin-bottom: 15px; }
    .menu-content p { font-size: 13px; color: #555; margin-bottom: 10px; }

    /* LOGO & LAYOUT */
    .logo-img { width: 200px; height: auto; margin-bottom: 20px; margin-top: 25px; }
    .subtitle { font-size: 15px; color: #444; font-weight: 800; text-transform: uppercase; margin-bottom: 20px; letter-spacing: 0.5px; }

    /* REVIEW CARD */
    .review-section-wrapper {
        position: relative; width: 92%; max-width: 600px;
        display: flex; flex-direction: column; align-items: center; margin-bottom: 50px; 
    }
    .review-box {
      position: relative; width: 100%; min-height: 120px;
      background: white; border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08); padding-bottom: 20px;
      margin-bottom: 0; overflow: hidden;
    }
    .carousel-track { display: flex; width: 100%; transition: transform 0.4s ease-in-out; }
    .carousel-slide {
      min-width: 100%; padding: 35px 40px 10px 40px; 
      display: flex; flex-direction: column; align-items: flex-start; text-align: left;
    }
    .review-text-content { font-size: 14px; line-height: 1.5; font-weight: 600; color: #333; }
    
    /* LOADING TEXT STYLE */
    .loading-text {
        font-size: 11px; color: #888; font-weight: 500; font-style: italic;
        width: 100%; text-align: center; margin-top: 10px;
        animation: blink 1.5s infinite;
    }
    @keyframes blink { 50% { opacity: 0.5; } }

    .nav-arrow {
      position: absolute; top: 50%; transform: translateY(-50%);
      background: rgba(0,0,0,0.03); border: none; width: 28px; height: 28px;
      border-radius: 50%; font-size: 16px; color: #333; cursor: pointer; z-index: 5;
    }
    .nav-arrow.prev { left: 5px; }
    .nav-arrow.next { right: 5px; }
    .nav-arrow:disabled { opacity: 0.2; }

    .slide-counter {
      position: absolute; top: 10px; right: 20px; font-size: 10px;
      color: #999; background: #f5f5f5; padding: 2px 8px; border-radius: 8px;
    }

    /* COPY BUTTON */
    .copy-btn-half {
        position: absolute; bottom: -18px; left: 50%; transform: translateX(-50%);
        background: #1976d2; color: white; border: none;
        padding: 9px 28px; border-radius: 50px; font-weight: 600; font-size: 13px;
        cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 10;
        white-space: nowrap; transition: 0.2s;
    }
    .copy-btn-half:active { transform: translateX(-50%) scale(0.95); }

    /* ====== ANIMATED GOOGLE BUTTON ====== */
    .google-btn {
      display: inline-block; 
      margin-top: 20px; 
      border-radius: 50px; 
      text-decoration: none; 
      color: #fff; 
      font-weight: 700; 
      font-size: 15px;
      padding: 13px 40px;
      
      background: linear-gradient(90deg, #4285F4, #34A853, #FBBC05, #EA4335, #4285F4, #34A853);
      background-size: 300% 100%; 
      animation: googleFlow 4s linear infinite; 
      
      box-shadow: 0 4px 15px rgba(66, 133, 244, 0.3);
      cursor: pointer; 
      transition: transform 0.2s, box-shadow 0.2s;
      letter-spacing: 0.5px; position: relative; z-index: 1;
      opacity: 1; pointer-events: auto; filter: none;
    }

    @keyframes googleFlow {
      0% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }

    .google-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(66, 133, 244, 0.5);
    }
    
    /* OTHER UI */
    .star-section { margin-top: 35px; color: #000; }
    .stars { font-size: 22px; letter-spacing: 2px; }
    .thanks { font-family: 'Rubik Wet Paint', cursive; font-size: 26px; margin-top: 20px; }

    /* ====== SMALL AESTHETIC GENDER POPUP ====== */
    .gender-popup-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(255, 255, 255, 0.6); 
        backdrop-filter: blur(12px); 
        z-index: 5000; 
        display: flex; justify-content: center; align-items: center;
        flex-direction: column;
    }
    
    .gender-popup-box {
        background: rgba(255, 255, 255, 0.95);
        padding: 30px 25px; 
        border-radius: 20px; 
        box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        text-align: center;
        width: 80%; max-width: 280px; 
        border: 1px solid rgba(255,255,255,1);
        animation: popIn 0.4s ease-out;
    }
    
    @keyframes popIn {
        from { transform: scale(0.9); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }

    .gender-title { font-size: 18px; color: #222; margin-bottom: 5px; font-weight: 700; }
    .gender-subtitle { font-size: 12px; color: #777; margin-bottom: 20px; }

    .gender-btn-container { display: flex; flex-direction: column; gap: 10px; width: 100%; }

    .gender-btn {
        padding: 12px; border: none; border-radius: 12px;
        font-size: 14px; font-weight: 600; cursor: pointer;
        transition: transform 0.2s;
        display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .gender-btn.male { background: #f0f7ff; color: #1976d2; border: 1px solid #e3f2fd; }
    .gender-btn.female { background: #fff0f5; color: #d81b60; border: 1px solid #fce4ec; }
    .gender-btn:active { transform: scale(0.96); }

    /* POPUP OVERLAY (Copy Alert) */
    .popup-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.5); z-index: 2000;
      justify-content: center; align-items: center;
    }
    .popup-overlay.show { display: flex; }
    .popup-box {
      background: white; border-radius: 15px; padding: 20px; max-width: 250px;
      width: 75%; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.25);
    }

    /* ====== NEW: FULL SCREEN STAR ANIMATION ====== */
    .star-animation-overlay {
      display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      z-index: 3000; justify-content: center; align-items: center;
      flex-direction: column; animation: slideDown 0.5s ease-out;
    }
    .star-animation-overlay.show { display: flex; }

    @keyframes slideDown {
      from { transform: translateY(-100%); }
      to { transform: translateY(0); }
    }

    .animation-text {
      font-size: 24px; color: white; font-weight: 700; margin-bottom: 30px;
      text-align: center; text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }

    .animated-stars { display: flex; gap: 15px; font-size: 50px; }
    .animated-star {
      opacity: 0.3; transition: all 0.5s ease; filter: grayscale(100%);
    }
    .animated-star.light {
      opacity: 1; filter: grayscale(0%); animation: starGlow 0.5s ease;
    }

    @keyframes starGlow {
      0% { transform: scale(1); }
      50% { transform: scale(1.3); }
      100% { transform: scale(1); }
    }

  </style>
</head>

<body>

  <div class="star-animation-overlay" id="starAnimationOverlay">
    <div class="animation-text">Give 5 Stars and Paste the Text</div>
    <div class="animated-stars">
      <span class="animated-star">‚≠ê</span>
      <span class="animated-star">‚≠ê</span>
      <span class="animated-star">‚≠ê</span>
      <span class="animated-star">‚≠ê</span>
      <span class="animated-star">‚≠ê</span>
    </div>
  </div>

  <div class="gender-popup-overlay" id="genderPopupOverlay">
    <div class="gender-popup-box">
      <div class="gender-title">Welcome</div>
      <div class="gender-subtitle">Select gender to continue</div>
      
      <div class="gender-btn-container">
        <button class="gender-btn male" onclick="selectGender('male')">
            <span>üë®</span> Male
        </button>
        <button class="gender-btn female" onclick="selectGender('female')">
            <span>üë©</span> Female
        </button>
      </div>
    </div>
  </div>

  <div class="top-banner">
      <span class="banner-text">CityKart</span>
  </div>

  <button class="menu-btn" id="menuBtn">
    <span></span><span></span><span></span>
  </button>

  <button class="type-btn-fixed" id="typeBtn">Type</button>

  <button class="instruction-btn" id="instructionBtn"></button>

  <div class="quick-info-box" id="quickInfoBox">
    <div class="info-step">Step 1: Copy text</div>
    <div class="info-step">Step 2: Click Google Review</div>
    <div class="info-step">Step 3: Give 5 star</div>
    <div class="info-step">Step 4: Paste text</div>
  </div>

  <div class="menu-overlay" id="menuOverlay"></div>
  <div class="side-menu" id="sideMenu">
    <div class="menu-content">
      <h3>Policy & Information</h3>
      <p>All reviews are voluntary.</p>
      <p>Reviews reflect personal experience.</p>
      <p>.....................................</p>
      <p>This is a paid review promotion designed to help brands.</p>
    </div>
  </div>

  <img src="https://raw.githubusercontent.com/socialinfi321-svgph/komal/main/LOGO-PNG-.png.webp" alt="Logo" class="logo-img">

  <div class="subtitle">Contribute Google Review</div>

  <div class="review-section-wrapper">
      <div class="review-box" id="reviewBox">
        <div class="slide-counter" id="slideCounter">0/0</div>
        
        <button class="nav-arrow prev" id="prevBtn" disabled>&#10094;</button>
        <button class="nav-arrow next" id="nextBtn">&#10095;</button>

        <div class="carousel-track" id="carouselTrack">
          <div class="carousel-slide">
            <p class="loading-text">Loading reviews...</p>
          </div>
        </div>
      </div>

      <button class="copy-btn-half" id="copyBtn">Copy Text</button>
  </div>

  <a id="googleBtn" class="google-btn">Google Reviews</a>

  <div class="star-section">
    <span style="font-size: 10px; font-weight: 500;">Only give</span>
    <div class="stars">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</div>
    <span style="font-size: 10px; font-weight: 500;">Have a great day</span>
  </div>

  <div class="thanks">Thanks for supporting</div>

  <div class="popup-overlay" id="popupOverlay">
    <div class="popup-box">
      <div style="font-size: 14px; color: #333; font-weight: 600;">Please click 'Copy Text' first!</div>
    </div>
  </div>

<script>
    // üî¥ IMPORTANT: Replace with your NEW Web App URL
    const SHEET_API_URL = 'https://script.google.com/macros/s/AKfycbwrKgB2zzzQI1rrylAEy_kxbcxRRez56NViXD9vYeiQfvDD0DOe8M514MNTy49-shfl/exec';

    const carouselTrack = document.getElementById('carouselTrack');
    const copyBtn = document.getElementById('copyBtn');
    const typeBtn = document.getElementById('typeBtn');
    const googleBtn = document.getElementById('googleBtn');
    const popupOverlay = document.getElementById('popupOverlay');
    const menuBtn = document.getElementById('menuBtn');
    const sideMenu = document.getElementById('sideMenu');
    const menuOverlay = document.getElementById('menuOverlay');
    const instructionBtn = document.getElementById('instructionBtn');
    const quickInfoBox = document.getElementById('quickInfoBox');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const slideCounter = document.getElementById('slideCounter');
    const genderPopup = document.getElementById('genderPopupOverlay');
    
    // NEW ANIMATION ELEMENT
    const starAnimationOverlay = document.getElementById('starAnimationOverlay');

    let reviewData = []; 
    let currentSlide = 0;
    let copyClicked = false;
    let userGender = null;

    /* GENDER SELECTION LOGIC */
    function selectGender(gender) {
        userGender = gender;
        // Fade out Popup
        genderPopup.style.transition = 'opacity 0.3s';
        genderPopup.style.opacity = '0';
        setTimeout(() => {
            genderPopup.style.display = 'none';
        }, 300);

        // Fetch Reviews
        fetchAllReviews(gender);
        
        // Show instruction box briefly
        setTimeout(() => {
            quickInfoBox.classList.add('show');
            setTimeout(() => quickInfoBox.classList.remove('show'), 6000);
        }, 800);
    }

    /* === HYBRID FAST FETCHING LOGIC === */
    async function fetchAllReviews(gender) {
        carouselTrack.innerHTML = '<div class="carousel-slide"><p class="loading-text">Loading reviews...</p></div>';
        reviewData = [];

        // --- STEP 1: FETCH ONLY 1 REVIEW (VERY FAST) ---
        try {
            const response1 = await fetch(`${SHEET_API_URL}?action=reserve&gender=${gender}`);
            const text1 = await response1.text();
            let data1;
            try { data1 = JSON.parse(text1); } catch { data1 = { review: text1, id: null }; }

            if (data1.review) {
                reviewData.push({ id: data1.id, text: data1.review });

                carouselTrack.innerHTML = '';
                const slide = document.createElement('div');
                slide.className = 'carousel-slide';
                slide.innerHTML = `<p class="review-text-content">${data1.review}</p>`;
                carouselTrack.appendChild(slide);

                updateSlidePosition();
                updateButtons();
            }
        } catch (e) {
            console.error("1st Review Fetch Error", e);
        }

        // --- STEP 2: FETCH REMAINING 4 REVIEWS (BACKGROUND) ---
        const reviewsToFetch = 4;
        const fetchPromises = [];

        for (let i = 0; i < reviewsToFetch; i++) {
            fetchPromises.push(
                fetch(`${SHEET_API_URL}?action=reserve&gender=${gender}`)
                .then(res => res.text())
                .then(text => {
                    try { return JSON.parse(text); } 
                    catch { return { review: text, id: null }; }
                })
            );
        }

        try {
            const results = await Promise.all(fetchPromises);
            results.forEach(data => {
                if (data.review) {
                    reviewData.push({ id: data.id, text: data.review });
                    const slide = document.createElement('div');
                    slide.className = 'carousel-slide';
                    slide.innerHTML = `<p class="review-text-content">${data.review}</p>`;
                    carouselTrack.appendChild(slide);
                }
            });
            updateSlidePosition();
            updateButtons();
        } catch (err) {
            console.error("Background Fetch Error", err);
        }

        window.addEventListener('beforeunload', () => {
            if (!copyClicked) releaseAllReviews();
        });
    }

    /* CAROUSEL LOGIC */
    function updateSlidePosition() {
        if(reviewData.length === 0) return;
        carouselTrack.style.transform = `translateX(-${currentSlide * 100}%)`;
        slideCounter.textContent = `${currentSlide + 1}/${reviewData.length}`;
    }

    function updateButtons() {
        prevBtn.disabled = currentSlide === 0;
        nextBtn.disabled = currentSlide === reviewData.length - 1;
    }

    nextBtn.addEventListener('click', () => {
        if (currentSlide < reviewData.length - 1) {
            currentSlide++; updateSlidePosition(); updateButtons();
            resetCopyState();
        }
    });

    prevBtn.addEventListener('click', () => {
        if (currentSlide > 0) {
            currentSlide--; updateSlidePosition(); updateButtons();
            resetCopyState();
        }
    });

    function resetCopyState() {
        copyBtn.innerText = "Copy Text";
        copyBtn.style.background = "#1976d2";
        copyClicked = false;
    }

    /* COPY LOGIC */
    copyBtn.addEventListener("click", async () => {
        if (reviewData.length === 0) return;
        const currentText = reviewData[currentSlide].text;
        
        try {
            await navigator.clipboard.writeText(currentText);
            successCopy();
        } catch (err) {
            const textarea = document.createElement("textarea");
            textarea.value = currentText;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand("copy");
            document.body.removeChild(textarea);
            successCopy();
        }
    });

    function successCopy() {
        copyBtn.innerText = "Copied ‚úì";
        copyBtn.style.background = "#43a047";
        copyClicked = true;
    }

    /* NEW ANIMATION FUNCTION */
    function showStarAnimation() {
      starAnimationOverlay.classList.add('show');
      
      const stars = document.querySelectorAll('.animated-star');
      
      stars.forEach((star, index) => {
        setTimeout(() => {
          star.classList.add('light');
        }, index * 400);
      });

      setTimeout(() => {
        starAnimationOverlay.classList.remove('show');
        stars.forEach(star => star.classList.remove('light'));
        window.open('https://reviewthis.biz/9580d9a4', '_blank');
      }, 3000);
    }

    /* GOOGLE BUTTON LOGIC - UPDATED TO TRIGGER ANIMATION */
    googleBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        
        if (!copyClicked) {
            popupOverlay.classList.add('show');
            setTimeout(() => popupOverlay.classList.remove('show'), 2000);
            return;
        }

        const currentId = reviewData[currentSlide].id;
        if (currentId) {
            fetch(`${SHEET_API_URL}?action=confirmUsed&id=${currentId}`, { mode: 'no-cors' });
        }

        // TRIGGER ANIMATION INSTEAD OF DIRECT OPEN
        showStarAnimation();
    });

    /* TYPE BUTTON LOGIC */
    typeBtn.addEventListener("click", () => {
        window.open('https://reviewthis.biz/9580d9a4', '_blank');
    });

    async function releaseAllReviews() {
        for (let item of reviewData) {
           if(item.id) navigator.sendBeacon(`${SHEET_API_URL}?action=release&id=${item.id}`);
        }
    }

    /* MENU UI */
    menuBtn.addEventListener('click', () => { sideMenu.classList.add('open'); menuOverlay.classList.add('show'); });
    menuOverlay.addEventListener('click', () => { sideMenu.classList.remove('open'); menuOverlay.classList.remove('show'); });
    instructionBtn.addEventListener('click', () => {
        quickInfoBox.classList.toggle('show');
    });

</script>

</body>
</html>
